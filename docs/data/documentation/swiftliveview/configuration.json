{"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/Configuration"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/swiftliveview\/configuration"]}],"schemaVersion":{"patch":0,"minor":3,"major":0},"seeAlsoSections":[{"identifiers":["doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/GettingStarted","doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/Component","doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/Router","doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/Handler"],"title":"Articles","generated":true}],"metadata":{"role":"article","modules":[{"name":"SwiftLiveView"}],"title":"Configuration","roleHeading":"Article"},"hierarchy":{"paths":[["doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView"]]},"sections":[],"abstract":[{"type":"text","text":"Possible additional configuration optios for your "},{"isActive":true,"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView","type":"reference"},{"text":" app.","type":"text"}],"primaryContentSections":[{"content":[{"anchor":"Overview","level":2,"text":"Overview","type":"heading"},{"inlineContent":[{"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView","isActive":true,"type":"reference"},{"text":" can be configured to match your needs. There are several configuartion options taht you can use right away, or you can experiment and create your own configuration. This article showcases mandatory configuartion steps and explains options for custom configuration. Mandatory steps are also shown in ","type":"text"},{"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/GettingStarted","isActive":true},{"type":"text","text":" article."}],"type":"paragraph"},{"type":"heading","level":3,"anchor":"Mandatory-steps","text":"Mandatory steps"},{"type":"paragraph","inlineContent":[{"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView","isActive":true,"type":"reference"},{"text":" uses ","type":"text"},{"code":"JWT","type":"codeVoice"},{"type":"text","text":" tokens in its communication process with client. It is required to generate private and public keys befored deployment."}]},{"type":"heading","level":4,"text":"Private and public keys","anchor":"Private-and-public-keys"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Both key pairs has to be supplied to the "},{"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveViewHandler","isActive":true},{"text":" as ","type":"text"},{"code":"String","type":"codeVoice"},{"type":"text","text":"s. You can follow "},{"identifier":"https:\/\/kentakodashima.medium.com\/generate-pem-keys-with-openssl-on-macos-ecac55791373","isActive":true,"type":"reference"},{"text":" article to generate get ","type":"text"},{"code":"PEM","type":"codeVoice"},{"type":"text","text":" formatted keys. Signer is expecting them to be in "},{"type":"codeVoice","code":"rs256"},{"type":"text","text":" format."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"As general rule of thumb you can use following command to export your public key to "},{"type":"codeVoice","code":"PEM"},{"type":"text","text":" format. Following code was taken from "},{"identifier":"https:\/\/serverfault.com\/a\/706412","type":"reference","isActive":true},{"type":"text","text":" post."}]},{"syntax":null,"type":"codeListing","code":["ssh-keygen -f id_rsa.pub -m 'PEM' -e > id_rsa.pub.pem"]},{"inlineContent":[{"text":"Then simply copy the .pem key as necessary.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Options as follows: (See man ssh-keygen)"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"-f id_rsa.pub: input file"},{"text":" ","type":"text"},{"text":"-m ‘PEM’: output format PEM","type":"text"},{"type":"text","text":" "},{"text":"-e: output to STDOUT","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Consider providing your app with keys using ","type":"text"},{"code":"Environment","type":"codeVoice"}],"type":"paragraph"},{"type":"heading","text":"Client and server messages","level":4,"anchor":"Client-and-server-messages"},{"type":"paragraph","inlineContent":[{"isActive":true,"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView","type":"reference"},{"type":"text","text":" provides you with base templates which you can use for structuring client and server messages between client and server. These are "},{"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/BaseClientMessage","isActive":true},{"type":"text","text":" and "},{"isActive":true,"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/BaseServerMessage"},{"type":"text","text":". "},{"isActive":true,"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/BaseClientMessage","type":"reference"},{"text":" further takes generic paramter which dictates structure of action parameter of ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/BaseClientMessage"},{"text":".","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"Define your ","type":"text"},{"code":"Action","type":"codeVoice"},{"type":"text","text":" structure and typealias it in your app as follows. Now you can use these in your app."}]},{"syntax":"swift","code":["public enum Action: String, Decodable {","    case live_href = \"live-href\"","}","","typealias ClientMessage = BaseClientMessage<Action>"],"type":"codeListing"},{"type":"heading","anchor":"In-configure-method","level":4,"text":"In configure method"},{"inlineContent":[{"text":"You start configuration in your app’s ","type":"text"},{"type":"codeVoice","code":"configure()"},{"type":"text","text":" method."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"First you need to use "},{"type":"codeVoice","code":"WebSocketInitializer"},{"type":"text","text":" middleware, that provides response with minimal JavaScript code that is needed to respond to server messages."}]},{"inlineContent":[{"text":"Then we need to create and set ","type":"text"},{"isActive":true,"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveViewHandler","type":"reference"},{"type":"text","text":" handler."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"To do this you need to create configuration using ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveViewHandlerConfiguration"},{"text":" which further accepts ","type":"text"},{"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveRouter","isActive":true},{"type":"text","text":" as router and "},{"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/WebSocketCloseStrategy","isActive":true,"type":"reference"},{"text":".","type":"text"}]},{"inlineContent":[{"text":"your router definition may look something like this:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["let router = LiveRouter<String, ClientMessage> {","    \/\/ View that is rendered at invalid path request","    TokamakStaticHTML.StaticHTMLRenderer(InvalidPath()).render()","} handleMessage: { router, request, message, socket in","    \/\/ to change router url we have to decide based on the action ","    \/\/ because it might be defined by user it needs to be handled outside ","    \/\/ of the actual router","    if message.action == .live_href {","        try? router.changeURL(request, socket, to: message.value ?? \"\/\", for: message.authToken)","    } else {","        \/\/ all other messages should be passed to current component","        await router.passMessageToCurrentComponent(message, from: socket)","    }","}"],"type":"codeListing"},{"syntax":"swift","type":"codeListing","code":["app.setLiveViewHandler(","    LiveViewHandler<ClientMessage>(","        configuration: LiveViewHandlerConfiguration<ClientMessage>(","            app: app,","            router: router,","            privateKeySecret: privateKeySecret,","            publicKeySecret: publicKeySecret,","            onCloseStrategy: .moveToSwap(after: 10, completion: { message, object in","                \/\/ After 10 seconds we will just get snapshot","                \/\/ furthermore we can save it to database or something","                guard let _ = message as? ClientMessage,","                      let object = object as? LiveIndex else { return }","                let _ = object.contextSnapshot()","            })","        ) {","            [","                LiveIndex(path: \"\/\",","                          app: app),","                LiveDetail(path: \"\/detail\",","                           app: app)","            ]","        }","    )",")"]},{"inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/WebSocketCloseStrategy"},{"type":"text","text":" provides you with option to manipulate connection data after certain amount of inactivity. In this example we access active component context."}],"type":"paragraph"},{"text":"Routes","level":4,"type":"heading","anchor":"Routes"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Configuration of routes is important for proper functionality of "},{"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView","type":"reference","isActive":true}]},{"type":"paragraph","inlineContent":[{"text":"Your app needs to issue ","type":"text"},{"code":"JWT","type":"codeVoice"},{"text":" token for client. It is requested automatically by client side code for path ","type":"text"},{"type":"codeVoice","code":"app\/issue-token"},{"type":"text","text":". It uses "},{"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/TokenGenerator","type":"reference","isActive":true},{"type":"text","text":" to issue the token"}]},{"code":["app.get(\"api\", \"issue-token\") { req async throws -> String in","    try TokenGenerator.generateToken(app)","}"],"syntax":"swift","type":"codeListing"},{"inlineContent":[{"type":"text","text":"After issuing the token, client tries to open "},{"code":"WebSocket","type":"codeVoice"},{"type":"text","text":" connection. To handle incoming "},{"code":"WebSocket","type":"codeVoice"},{"type":"text","text":" request you need to register handler method as follows:"}],"type":"paragraph"},{"type":"codeListing","code":["let handler: LiveViewHandler<ClientMessage> = app.liveViewHandler()","app.webSocket(\"websocket\", onUpgrade: handler.handleWebsocket)"],"syntax":"swift"},{"text":"Custom configuration","type":"heading","level":3,"anchor":"Custom-configuration"},{"type":"heading","level":4,"anchor":"Registration-of-new-JavaScript-methods","text":"Registration of new JavaScript methods"},{"inlineContent":[{"type":"text","text":"When using "},{"code":"WebSocketInitializer","type":"codeVoice"},{"text":" we can initialize it with custom ","type":"text"},{"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/JavaScriptLoader","isActive":true},{"text":" instance.","type":"text"},{"type":"text","text":" "},{"isActive":true,"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/JavaScriptLoader"},{"type":"text","text":" can register new handling methods directly on the user end. Contets of registering method may look something like this:"}],"type":"paragraph"},{"syntax":"js","code":["let method = (context, action, object) => {","    context.apllyCallbackToElements(object, action.selector, (element, elementID) => {","        element.addEventListener(\"mouseover\", (event) => {","          \/\/ Send message to server\/Handle mousover event","        });","    });","}"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"and its registration","type":"text"}]},{"syntax":"swift","code":["loader.registerClientMessageAction(liveSelector: \"live-onover\", withContents: method)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"In similar fashion you can register new methods to handle server messages. Please refer to "},{"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/JavaScriptLoader","isActive":true,"type":"reference"},{"type":"text","text":" to see all methods that can be utilized for customization of loader."}],"type":"paragraph"}],"kind":"content"}],"kind":"article","references":{"doc://SwiftLiveView/documentation/SwiftLiveView/GettingStarted":{"type":"topic","role":"article","title":"Hello world!","kind":"article","url":"\/documentation\/swiftliveview\/gettingstarted","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/GettingStarted","abstract":[{"type":"text","text":"Say hello to the world! Create your first interactive website hassle(JavaScript) free!"}]},"https://kentakodashima.medium.com/generate-pem-keys-with-openssl-on-macos-ecac55791373":{"title":"this","identifier":"https:\/\/kentakodashima.medium.com\/generate-pem-keys-with-openssl-on-macos-ecac55791373","type":"link","titleInlineContent":[{"text":"this","type":"text"}],"url":"https:\/\/kentakodashima.medium.com\/generate-pem-keys-with-openssl-on-macos-ecac55791373"},"doc://SwiftLiveView/documentation/SwiftLiveView/BaseServerMessage":{"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/BaseServerMessage","role":"symbol","title":"BaseServerMessage","abstract":[],"type":"topic","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"kind":"identifier","text":"BaseServerMessage"}],"navigatorTitle":[{"text":"BaseServerMessage","kind":"identifier"}],"kind":"symbol","url":"\/documentation\/swiftliveview\/baseservermessage"},"doc://SwiftLiveView/documentation/SwiftLiveView/Router":{"title":"Router","url":"\/documentation\/swiftliveview\/router","type":"topic","role":"article","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/Router","abstract":[{"text":"Routing heart of every ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView"},{"type":"text","text":" app."}],"kind":"article"},"https://serverfault.com/a/706412":{"title":"this","identifier":"https:\/\/serverfault.com\/a\/706412","type":"link","titleInlineContent":[{"text":"this","type":"text"}],"url":"https:\/\/serverfault.com\/a\/706412"},"doc://SwiftLiveView/documentation/SwiftLiveView/LiveViewHandler":{"role":"symbol","navigatorTitle":[{"text":"LiveViewHandler","kind":"identifier"}],"kind":"symbol","abstract":[{"type":"text","text":"Main handler for webSocket connections"}],"url":"\/documentation\/swiftliveview\/liveviewhandler","type":"topic","fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"kind":"identifier","text":"LiveViewHandler"}],"title":"LiveViewHandler","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveViewHandler"},"doc://SwiftLiveView/documentation/SwiftLiveView/LiveRouter":{"type":"topic","navigatorTitle":[{"text":"LiveRouter","kind":"identifier"}],"role":"symbol","kind":"symbol","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveRouter","abstract":[{"type":"text","text":"Router that manages components for client"}],"url":"\/documentation\/swiftliveview\/liverouter","title":"LiveRouter","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"text":"LiveRouter","kind":"identifier"}]},"doc://SwiftLiveView/documentation/SwiftLiveView/BaseClientMessage":{"navigatorTitle":[{"kind":"identifier","text":"BaseClientMessage"}],"abstract":[{"text":"Base client message representation","type":"text"},{"text":" ","type":"text"},{"text":"Should correspond to messages that are sent from client","type":"text"}],"title":"BaseClientMessage","url":"\/documentation\/swiftliveview\/baseclientmessage","type":"topic","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"BaseClientMessage","kind":"identifier"}],"role":"symbol","kind":"symbol","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/BaseClientMessage"},"doc://SwiftLiveView/documentation/SwiftLiveView/LiveViewHandlerConfiguration":{"url":"\/documentation\/swiftliveview\/liveviewhandlerconfiguration","title":"LiveViewHandlerConfiguration","kind":"symbol","navigatorTitle":[{"text":"LiveViewHandlerConfiguration","kind":"identifier"}],"abstract":[{"text":"Configuartion for ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveViewHandler"}],"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveViewHandlerConfiguration","role":"symbol","type":"topic","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"text":"LiveViewHandlerConfiguration","kind":"identifier"}]},"doc://SwiftLiveView/documentation/SwiftLiveView/JavaScriptLoader":{"type":"topic","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/JavaScriptLoader","url":"\/documentation\/swiftliveview\/javascriptloader","abstract":[{"type":"text","text":"Loader of client side javaScript"}],"fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"JavaScriptLoader"}],"kind":"symbol","navigatorTitle":[{"text":"JavaScriptLoader","kind":"identifier"}],"title":"JavaScriptLoader","role":"symbol"},"doc://SwiftLiveView/documentation/SwiftLiveView/WebSocketCloseStrategy":{"fragments":[{"text":"enum","kind":"keyword"},{"kind":"text","text":" "},{"text":"WebSocketCloseStrategy","kind":"identifier"}],"navigatorTitle":[{"text":"WebSocketCloseStrategy","kind":"identifier"}],"url":"\/documentation\/swiftliveview\/websocketclosestrategy","role":"symbol","abstract":[{"text":"Completion that is fired after certain","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"time interval of webSocket connection inactivity"}],"kind":"symbol","type":"topic","title":"WebSocketCloseStrategy","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/WebSocketCloseStrategy"},"doc://SwiftLiveView/documentation/SwiftLiveView/Component":{"url":"\/documentation\/swiftliveview\/component","role":"article","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/Component","type":"topic","abstract":[{"type":"text","text":"Representation of route state."}],"title":"Component","kind":"article"},"doc://SwiftLiveView/documentation/SwiftLiveView/Handler":{"role":"article","kind":"article","url":"\/documentation\/swiftliveview\/handler","type":"topic","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/Handler","abstract":[{"isActive":true,"type":"reference","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/LiveViewHandler"},{"type":"text","text":" is heart of every "},{"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView","type":"reference","isActive":true},{"text":" framework.","type":"text"}],"title":"Handler"},"doc://SwiftLiveView/documentation/SwiftLiveView":{"kind":"symbol","identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView","type":"topic","title":"SwiftLiveView","abstract":[{"text":"Template language independent server side rendering framework written in Swift.","type":"text"}],"url":"\/documentation\/swiftliveview","role":"collection"},"doc://SwiftLiveView/documentation/SwiftLiveView/TokenGenerator":{"url":"\/documentation\/swiftliveview\/tokengenerator","navigatorTitle":[{"text":"TokenGenerator","kind":"identifier"}],"identifier":"doc:\/\/SwiftLiveView\/documentation\/SwiftLiveView\/TokenGenerator","role":"symbol","abstract":[{"code":"JWT","type":"codeVoice"},{"text":" token generator","type":"text"}],"fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"text":"TokenGenerator","kind":"identifier"}],"title":"TokenGenerator","type":"topic","kind":"symbol"}}}